#####################################################
# Create Packages Template
###########################################

parameters:
  #####################
  # Common parameters #
  #####################
  h1: ""
  h2: ""
  baseURL: ""
  authToken: ""
  VERBOSE: ""
  SLEEP_TIMER: ""
  WORKSPACE: ""
  SCRIPTS_HOME: ""
  BUILD_USER_ID: ""

  #######################
  # Specific parameters #
  #######################
  branchName: "" # Optional: Boomi branch name for component packaging
  componentIds: "" # Comma-separated component IDs (alternative to processNames)
  componentType: "" # Component type filter
  extractComponentXmlFolder: "" # Optional: folder for XML extraction
  notes: "" # Package creation notes
  packageVersion: "" # Package version string
  processNames: "" # Comma-separated process names (alternative to componentIds)
  tag: "" # Optional: Git tag for release

steps:
  - script: |
      ####################
      # Common variables #
      ####################
      export h1="${{ parameters.h1 }}"
      export h2="${{ parameters.h2 }}"
      export baseURL="${{ parameters.baseURL }}"
      export authToken="${{ parameters.authToken }}"
      export VERBOSE="${{ parameters.VERBOSE }}"
      export SLEEP_TIMER="${{ parameters.SLEEP_TIMER }}"
      export WORKSPACE="${{ parameters.WORKSPACE }}"
      export SCRIPTS_HOME="${{ parameters.SCRIPTS_HOME }}"

      ######################
      # Specific variables #
      ######################
      export branchName="${{ parameters.branchName }}"
      export componentIds="${{ parameters.componentIds }}"
      export componentType="${{ parameters.componentType }}"
      export extractComponentXmlFolder="${{ parameters.extractComponentXmlFolder }}"
      export notes="${{ parameters.notes }}"
      export packageVersion="${{ parameters.packageVersion }}"
      export processNames="${{ parameters.processNames }}"
      export tag="${{ parameters.tag }}"

      #############
      # Execution #
      #############
      if [ "$ERROR" -gt 0 ]; then
        echo "❌ Package creation failed: $ERROR_MESSAGE"
        exit 1
      fi

      echo "✅ Package created successfully: ${packageId}"

      # Export packageId for use in subsequent stages
      echo "##vso[task.setvariable variable=packageId;isOutput=true]${packageId}"
    name: output_variable
    displayName: "Create Boomi Package"
